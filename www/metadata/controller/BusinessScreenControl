{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "views": [
            "BusinessScreen"
        ],
        "designer|userClassName": "BusinessScreenControl"
    },
    "designerId": "64ba0f18-128c-4bf1-a3d4-708ddeb1f3ee",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "BusinessScreen",
                "selector": "#BusinessScreen",
                "xtype": "Ext.Panel"
            },
            "designerId": "1c8f6a9b-fe1e-46a2-abb3-bd714d4d59f8"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onBusinessPanelShow",
                "implHandler": [
                    "console.log('onBusinessPanelInitialize');\r",
                    "\r",
                    "this.ReloadBusinessData();"
                ],
                "name": "show",
                "designer|targetType": "Ext.Panel",
                "designer|controlQuery": "BusinessScreen"
            },
            "designerId": "623a5109-4efd-422e-843a-a5cb01d86e8e"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "goingbutton",
                "selector": "#goingbutton",
                "xtype": "Ext.Button"
            },
            "designerId": "ff16cc04-a0c2-4995-a948-bdf3517353cb"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "ongoingbtnTap",
                "implHandler": [
                    "console.log('ongoingbtnTap');\r",
                    "var BusinessID = Ext.ComponentQuery.query('#BusinessScreen')[0].business_id;\r",
                    "\r",
                    "if(BusinessID){\r",
                    "    //load main business data\r",
                    "    var GeneralActionStore = Ext.getStore('GeneralActionStore');\r",
                    "    var url = 'http://'+localStorage.serverpath+'/Server-side/BusinessesGoing.php';\r",
                    "    var proxy= GeneralActionStore.getProxy();\r",
                    "    proxy.setUrl(url);\r",
                    "    proxy.setExtraParam('BusinessID', BusinessID );\r",
                    "    GeneralActionStore.load({callback: function(records, operation, success) {\r",
                    "        var count = GeneralActionStore.getCount();\r",
                    "        var data = GeneralActionStore.getRange();\r",
                    "        console.log('GeneralActionStore count : ' + count);\r",
                    "        console.log('GeneralActionStore data : ' + data);\r",
                    "\r",
                    "        var ResultRecord = GeneralActionStore.getAt(0);\r",
                    "        var Result = ResultRecord.get('result');\r",
                    "        console.log('Result:'+Result);\r",
                    "\r",
                    "        if(Result=='true')\r",
                    "        {\r",
                    "            //TODO: increas the going label +1\r",
                    "            goingCountlbl = button.up('container').down('container[id=goinglblcont]');\r",
                    "            goingCount = parseInt(goingCountlbl.getHtml());\r",
                    "            if(!goingCount)\r",
                    "                goingCount=0;\r",
                    "            goingCount = goingCount +1;\r",
                    "            goingCountlbl.setHtml(goingCount);\r",
                    "\r",
                    "            button.setBaseCls('businessgoingbtnactive');\r",
                    "            button.setDisabled(true);\r",
                    "        }\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    "}"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "goingbutton"
            },
            "designerId": "fb0db788-3358-4433-a1dc-4b8e88c5d6d3"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onwebsiteTitleTap",
                "implHandler": [
                    "console.log('onhomepagebtnTap');\r",
                    "var LocalStore = Ext.getStore('LocalStore'); // Shortcut\r",
                    "var aRecord = LocalStore.getAt(0);\r",
                    "var BusinessID = aRecord.get('SelectedBusinessID');\r",
                    "\r",
                    "var MethodName ='BusinessClickHomepage';\r",
                    "\r",
                    "//load main business data\r",
                    "var GeneralActionStore = Ext.getStore('GeneralActionStore');\r",
                    "var url = 'http://'+localStorage.serverpath+'/Server-side/BusinessesGeneralAPI.php';\r",
                    "var proxy= GeneralActionStore.getProxy();\r",
                    "proxy.setUrl(url);\r",
                    "proxy.setExtraParam('BusinessID', BusinessID );\r",
                    "proxy.setExtraParam('MethodName', 'BusinessClickHomepage' );\r",
                    "GeneralActionStore.load({callback: function(records, operation, success) {\r",
                    "    //console.log('callback onhomepagebtnTap');\r",
                    "    var count = GeneralActionStore.getCount();\r",
                    "    var data = GeneralActionStore.getRange();\r",
                    "    console.log('GeneralActionStore count : ' + count);\r",
                    "    console.log('GeneralActionStore data : ' + data);\r",
                    "\r",
                    "    var ResultRecord = GeneralActionStore.getAt(0);\r",
                    "    var Result = ResultRecord.get('result');\r",
                    "    console.log('Result:'+Result);\r",
                    "\r",
                    "    //read the HOME PAGE URL\r",
                    "    var BusinessStore = Ext.getStore('BusinessStore');\r",
                    "    var BusinessRecord = BusinessStore.getAt(0);\r",
                    "    var HomePageURL = BusinessRecord.get('HomePageURL');\r",
                    "    console.log('HomePageURL:'+HomePageURL);\r",
                    "\r",
                    "    //launch the browser with the HOME PAGE URL\r",
                    "    if(Ext.os.is.iOS || Ext.os.is.Android)\r",
                    "    {\r",
                    "        Ext.device.Device.openURL(HomePageURL);\r",
                    "    }\r",
                    "    else\r",
                    "    {\r",
                    "        window.open(HomePageURL);\r",
                    "    }\r",
                    "}\r",
                    "});"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Label",
                "designer|controlQuery": "label"
            },
            "designerId": "f8af4125-703a-41e4-be27-cdc5064919a7"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "ratebtn",
                "selector": "#ratebtn",
                "xtype": "Ext.Button"
            },
            "designerId": "90605ba1-ca3e-4d62-a3ce-f3d13e30f0e2"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onratebtnTap",
                "implHandler": [
                    "console.log('onratebtnTap');\r",
                    "var ScreenSelector = '#RatePlaceScreen';\r",
                    "var view='MyApp.view.RatePlaceScreen';\r",
                    "var id='RatePlaceScreen';\r",
                    "\r",
                    "var BusinessID = Ext.ComponentQuery.query('#BusinessScreen')[0].business_id;\r",
                    "\r",
                    "button.setBaseCls('ratebuttonpressed');\r",
                    "\r",
                    "Screen = Ext.ComponentQuery.query(ScreenSelector);\r",
                    "\r",
                    "if(Screen.length===0)//not  exists yet\r",
                    "{\r",
                    "    Screen = Ext.create(view, {\r",
                    "        id: id\r",
                    "    });\r",
                    "\r",
                    "    Screen.business_id = BusinessID;\r",
                    "\r",
                    "    Ext.Viewport.setActiveItem(Screen);\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    Screen[0].business_id = BusinessID;\r",
                    "    Ext.Viewport.setActiveItem(Screen[0]);\r",
                    "}"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "ratebtn"
            },
            "designerId": "2440e6b4-df3b-46e6-b9fb-362b1bd298a8"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "InitializeControls",
                "designer|params": [
                    "callback"
                ],
                "implHandler": [
                    "console.log('InitializeControls');\r",
                    "//set the value of the going button\r",
                    "\r",
                    "var BusinessStore = Ext.getStore('BusinessStoreBusinessScreen');\r",
                    "var BusinessRecord = BusinessStore.getAt(0);\r",
                    "\r",
                    "//Going label\r",
                    "goingCountlbl = Ext.ComponentQuery.query('#goinglblcont')[0];\r",
                    "var GoingCounter = BusinessRecord.get('goingcounter');\r",
                    "goingCountlbl.setHtml(GoingCounter);\r",
                    "//TODO: if not clicked over the 24 hours, enable\r",
                    "Ext.ComponentQuery.query('#goingbutton')[0].setDisabled(false);\r",
                    "Ext.ComponentQuery.query('#goingbutton')[0].setBaseCls('businessgoingbtn');\r",
                    "\r",
                    "//business name header\r",
                    "businessnamelbl = Ext.ComponentQuery.query('#businessnamelbl')[0];\r",
                    "businessname = BusinessRecord.get('business_name');\r",
                    "businessnamelbl.setHtml(businessname);\r",
                    "\r",
                    "//image\r",
                    "Ext.ComponentQuery.query('#businessImage')[0].setSrc(BusinessRecord.get('logourl'));\r",
                    "//line lenght\r",
                    "\r",
                    "//business details\r",
                    "\r",
                    "var capacitypercent = 0;\r",
                    "if(BusinessRecord.get('capacitypercent'))\r",
                    "capacitypercent= BusinessRecord.get('capacitypercent');\r",
                    "var moreboys =0;\r",
                    "if(BusinessRecord.get('moreboys'))\r",
                    "moreboys= BusinessRecord.get('moreboys');\r",
                    "var moregirls=0;\r",
                    "if(BusinessRecord.get('moregirls'))\r",
                    "moregirls= BusinessRecord.get('moregirls');\r",
                    "var linelenght=0;\r",
                    "if(BusinessRecord.get('linelenght'))\r",
                    "linelenght= BusinessRecord.get('linelenght');\r",
                    "var likescounter = \"\";\r",
                    "if(BusinessRecord.get('likescounter'))\r",
                    "likescounter= \"\";//BusinessRecord.get('likescounter');\r",
                    "\r",
                    "\r",
                    "//line length: 103 min <br> 10.975 km <br> 48% full <br> +23\r",
                    "var distance = Ext.ComponentQuery.query('#BusinessScreen')[0].distance;\r",
                    "Ext.ComponentQuery.query('#businessTitle')[0].setHtml('Line Length:'+linelenght+' min <br>'+distance+' km <br> '+capacitypercent+'% full <br> +'+BusinessRecord.get('minage')+'');\r",
                    "\r",
                    "\r",
                    "\r",
                    "//like counter\r",
                    "//78 <br> 51% <br> 49%\r",
                    "Ext.ComponentQuery.query('#businesslikeComp')[0].setHtml(''+likescounter+'<br> '+moregirls+'%'+'<br> '+moreboys+'%');\r",
                    "\r",
                    "//calculate the last update minutes\r",
                    "var LastupdateTime = BusinessRecord.get('last_update_time');\r",
                    "//console.log(\"LastRatingTime:\"+LastRatingTime);\r",
                    "var diff;//the time diff between now and the last update time by user\r",
                    "var now = new Date(); // now\r",
                    "if(LastupdateTime)\r",
                    "{                       \r",
                    "    //calculate the diff in minutes since last update\r",
                    "    diff= now - LastupdateTime;\r",
                    "    var sign=diff<0?-1:1;\r",
                    "    diff/=sign; // or diff=Math.abs(diff);\r",
                    "    var minutes,milliseconds,seconds;\r",
                    "    diff=(diff-(milliseconds=diff%1000))/1000;\r",
                    "    //diff=(diff-(seconds=diff%60))/60;\r",
                    "    diff=((diff-(minutes=diff%60))/60);\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    diff=-1;//dummy value\t\r",
                    "}\r",
                    "\r",
                    "//last update time lbl\r",
                    "if(diff===-1)\r",
                    "{\r",
                    "    Ext.ComponentQuery.query('#bslastupdatelbl')[0].setHtml('Last Updated:');\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "\r",
                    "    Ext.ComponentQuery.query('#bslastupdatelbl')[0].setHtml('Last Updated:<b>'+diff+' minutes ago</b>');\r",
                    "}\r",
                    "\r",
                    "if(diff<5 && diff>=0)\r",
                    "{\r",
                    "    Ext.ComponentQuery.query('#dotcontainerbusiness')[0].setHtml('<img src=\"resources/images/green_b.png\" height=\"8\" width=\"8\")>');\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    Ext.ComponentQuery.query('#dotcontainerbusiness')[0].setHtml('<img src=\"resources/images/greydot.png\" height=\"8\" width=\"8\")>');\r",
                    "}\r",
                    "\r",
                    "\r",
                    "//websiteTitle\r",
                    "//launch the browser with the HOME PAGE URL\r",
                    "var homepageurl = BusinessRecord.get('homepageurl');\r",
                    "if(homepageurl===null || homepageurl ===\"\")//do not add the URL link\r",
                    "{\r",
                    "   \r",
                    "     Ext.ComponentQuery.query('#websiteTitle')[0].setHtml('Website:');\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    \r",
                    "    if(Ext.os.is.iOS || Ext.os.is.Android)\r",
                    "    {\r",
                    "        //Ext.ComponentQuery.query('#websiteTitle')[0].setHtml('Website:'+BusinessRecord.get('business_name')+' <img src=\"resources/images/link.png\" height=\"14\" width=\"14\" onclick=Ext.device.Device.openURL(\"'+BusinessRecord.get('homepageurl')+'\")>');\r",
                    "        Ext.ComponentQuery.query('#websiteTitle')[0].setHtml('Website:<a href=\"'+BusinessRecord.get('homepageurl')+'\">'+BusinessRecord.get('business_name')+'</a> <img src=\"resources/images/link.png\" height=\"14\" width=\"14\" onclick=Ext.device.Device.openURL(\"'+homepageurl+'\")>');\r",
                    "    }\r",
                    "    else\r",
                    "    {\r",
                    "        //Ext.ComponentQuery.query('#websiteTitle')[0].setHtml('Website:'+BusinessRecord.get('business_name')+' <img src=\"resources/images/link.png\" height=\"14\" width=\"14\" onclick=window.open(\"'+BusinessRecord.get('homepageurl')+'\")>');\r",
                    "        Ext.ComponentQuery.query('#websiteTitle')[0].setHtml('Website:<a href=\"'+BusinessRecord.get('homepageurl')+'\">'+BusinessRecord.get('business_name')+'</a> <img src=\"resources/images/link.png\" height=\"14\" width=\"14\" onclick=window.open(\"'+homepageurl+'\")>');\r",
                    "    }\r",
                    "}\r",
                    "//businessemail\r",
                    "Ext.ComponentQuery.query('#businessemail')[0].setHtml('Email:'+BusinessRecord.get('email'));\r",
                    "\r",
                    "//businessaddress\r",
                    "Ext.ComponentQuery.query('#businessaddress')[0].setHtml('Address:'+BusinessRecord.get('full_address'));\r",
                    "\r",
                    "//waze\r",
                    "Ext.ComponentQuery.query('#waze')[0].setHtml('Navigate with WAZE <img src=\"resources/images/link.png\" height=\"14\" width=\"14\">');\r",
                    "\r",
                    "//businesstodaystyle\r",
                    "Ext.ComponentQuery.query('#businesstodaystyle')[0].setHtml('Today style: '+BusinessRecord.get('todaystyle'));\r",
                    "\r",
                    "//businesstodaydeals\r",
                    "Ext.ComponentQuery.query('#businesstodaydeals')[0].setHtml('Today Deals: '+BusinessRecord.get('today_deals'));\r",
                    "\r",
                    "//businesssummary\r",
                    "Ext.ComponentQuery.query('#businesssummary')[0].setHtml(BusinessRecord.get('businesssummary'));                                            \r",
                    "\r",
                    "//TODO: set the Rating button\r",
                    "var LastRatingTime = BusinessRecord.get('lastratingtime');\r",
                    "//console.log(\"LastRatingTime:\"+LastRatingTime);\r",
                    "var diff;//the time diff between now and the last rating time by user\r",
                    "var now = new Date(); // now\r",
                    "if(LastRatingTime)\r",
                    "{                       \r",
                    "    //calculate the diff in minutes since last rating\r",
                    "    diff= now - LastRatingTime;\r",
                    "    var sign=diff<0?-1:1;\r",
                    "    diff/=sign; // or diff=Math.abs(diff);\r",
                    "    var minutes,milliseconds,seconds;\r",
                    "    diff=(diff-(milliseconds=diff%1000))/1000;\r",
                    "    //diff=(diff-(seconds=diff%60))/60;\r",
                    "    diff=((diff-(minutes=diff%60))/60);\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    diff=0;//dummy value\t\r",
                    "}\r",
                    "\r",
                    "\r",
                    "//var timediff = parseInt((now - LastRatingTime)/60); \r",
                    "var distanceMetter = (distance*1000);\r",
                    "console.log(\"time diff:\"+diff+\", LastRatingTime:\"+LastRatingTime+\", now:\"+now+\",  distanceMetter:\"+distanceMetter);\r",
                    "//activate the button\r",
                    "if(diff>15 && distanceMetter<=25 )\r",
                    "{\r",
                    "    console.log(\"ratebtn enabled\");\r",
                    "    Ext.ComponentQuery.query('#ratebtn')[0].setBaseCls('ratebutton');\r",
                    "    Ext.ComponentQuery.query('#ratebtn')[0].setDisabled(false);\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    console.log(\"ratebtn disabled\");\r",
                    "    Ext.ComponentQuery.query('#ratebtn')[0].setBaseCls('ratebuttonpressed');\r",
                    "    Ext.ComponentQuery.query('#ratebtn')[0].setDisabled(true);\r",
                    "}\r",
                    "\r",
                    "//business_phone\r",
                    "Ext.ComponentQuery.query('#showphone')[0].setText('Show phone number');\r",
                    "\r",
                    "callback();"
                ]
            },
            "designerId": "1b8a8f67-5d4d-4f32-8dc0-468d0f5fe9d9"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "InitializePhotos",
                "designer|params": [
                    "callback"
                ],
                "implHandler": [
                    "console.log('InitializePhotos');\r",
                    "\r",
                    "var carousel = Ext.ComponentQuery.query('#photocarousel')[0];\r",
                    "//remove all current items from the carousel\r",
                    "carousel.removeAll(true,true);\r",
                    "\r",
                    "//loop over the BusinessPhotosStore and add items to the carousel\r",
                    "var BusinessPhotosStore = Ext.getStore('BusinessPhotosStore');\r",
                    "BusinessPhotosStore.each(function(record){\r",
                    "\r",
                    "    /* var img = Ext.create('image',{\r",
                    "    xtype: 'image',\r",
                    "    src:record.get('PhotoURL'),\r",
                    "    cls:'businessphoto'\r",
                    "    });*/\r",
                    "\r",
                    "    //Ext.onReady(function(){\r",
                    "    carousel.add({\r",
                    "        html: '<img src=\"' + record.get('photourl') + '\" height=\"140\" width=\"140\">'\r",
                    "    });\r",
                    "    // });\r",
                    "\r",
                    "    //carousel.add(img);\r",
                    "});\r",
                    "\r",
                    "callback();"
                ]
            },
            "designerId": "455c8f7b-820b-4b9b-9e7c-8b09d742bed2"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "ReloadBusinessData",
                "implHandler": [
                    "console.log('ReloadBusinessData');\r",
                    "\r",
                    "/*var LocalStore = Ext.getStore('LocalStore'); // Shortcut\r",
                    "var aRecord = LocalStore.getAt(0);\r",
                    "var BusinessID = aRecord.get('SelectedBusinessID');*/\r",
                    "var BusinessID = Ext.ComponentQuery.query('#BusinessScreen')[0].business_id;\r",
                    "console.log('Selected business ID is: ' + BusinessID);\r",
                    "\r",
                    "\r",
                    "//load main business data\r",
                    "var BusinessStore = Ext.getStore('BusinessStoreBusinessScreen');\r",
                    "BusinessStore.removeAll(true);\r",
                    "\r",
                    "/*var UserStore = Ext.getStore('UserStore');\r",
                    "var aRecord = UserStore.getAt(0);\r",
                    "var user_id = aRecord.get('user_id');*/\r",
                    "\r",
                    "//BusinessStore.sync();\r",
                    "var url = 'http://'+localStorage.serverpath+'/Server-side/GetBusinessesByParams.php';\r",
                    "//var url = 'http://localhost/elitest_sencha_phonegap%20-%20biluim%202/elitest_sencha_phonegap/android/assets/www/Server-side/GetBusinessesByParams.php?id=5&filtered=2&sortingBy=id';\r",
                    "console.log(url);\r",
                    "var proxy= BusinessStore.getProxy();\r",
                    "proxy.setUrl(url);\r",
                    "proxy.setExtraParam('id', BusinessID );\r",
                    "proxy.setExtraParam('filtered', \"2\" );//business screen filter\r",
                    "proxy.setExtraParam('sortingBy', \"id\" );\r",
                    "proxy.setExtraParam('user_id', localStorage.user_id );\r",
                    "BusinessStore.load({callback: function(records, operation, success) {\r",
                    "    var count = BusinessStore.getCount();\r",
                    "    var data = BusinessStore.getRange();\r",
                    "    console.log('BusinessStore count : ' + count);\r",
                    "    console.log('BusinessStore data : ' + data);\r",
                    "\r",
                    "    var controller = MyApp.app.getController( 'MyApp.controller.BusinessScreenControl');\r",
                    "    controller.InitializeControls(function(){\r",
                    "        //locad photos\r",
                    "        var BusinessPhotosStore = Ext.getStore('BusinessPhotosStore');\r",
                    "        var proxy1= BusinessPhotosStore.getProxy();\r",
                    "        url = 'http://'+localStorage.serverpath+'/Server-side/GetBusinessPhotos.php';\r",
                    "        proxy1.setUrl(url);\r",
                    "        proxy1.setExtraParam('id', BusinessID );\r",
                    "        console.log(url);\r",
                    "        BusinessPhotosStore.load({callback: function(records, operation, success) {\r",
                    "            var count = BusinessPhotosStore.getCount();\r",
                    "            var data = BusinessPhotosStore.getRange();\r",
                    "            console.log('BusinessPhotosStore count : ' + count);\r",
                    "            console.log('BusinessPhotosStore data : ' + data);\r",
                    "\r",
                    "            //set the photos\r",
                    "            controller.InitializePhotos();\r",
                    "        }\r",
                    "    });  \r",
                    "});\r",
                    "\r",
                    "}\r",
                    "});\r",
                    ""
                ]
            },
            "designerId": "6ba1d6ed-3a49-42e9-bcb2-602232dc9358"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "RatingUserList",
                "selector": "#RatingUserList",
                "xtype": "list"
            },
            "designerId": "ad82dd05-76eb-42d5-a61a-71e130f7500f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onRatingUserListInitialize",
                "implHandler": [
                    "console.log('onRatingUserListInitialize');\r",
                    "\r",
                    "var LocalStore = Ext.getStore('LocalStore'); // Shortcut\r",
                    "var aRecord = LocalStore.getAt(0);\r",
                    "var BusinessID = aRecord.get('SelectedBusinessID');\r",
                    "\r",
                    "//var list = this.getRatingUserList();\r",
                    "var list = component;\r",
                    "var url = 'http://'+localStorage.serverpath+'/Server-side/GetBusinessUsers.php?id='+BusinessID;\r",
                    "console.log(url);\r",
                    "list.getStore().getProxy().setUrl(url);\r",
                    "list.getStore().load({callback: function(records, operation, success) {\r",
                    "    list.setMasked(false);\r",
                    "    console.log('MASK IS REMOVED!!');\r",
                    "    var count = list.getStore().getCount();\r",
                    "    var data = list.getStore().getRange();\r",
                    "    console.log('RatingUserList count : ' + count);\r",
                    "    console.log('RatingUserList data : ' + data);\r",
                    "    list.refresh();\r",
                    "    //list.show();\r",
                    "}\r",
                    "});"
                ],
                "name": "initialize",
                "designer|targetType": "Ext.dataview.List",
                "designer|controlQuery": "RatingUserList"
            },
            "designerId": "7e7aa487-a357-4657-9d45-432a28673697"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "showphone",
                "selector": "#showphone",
                "xtype": "Ext.Button"
            },
            "designerId": "e7afdbf0-b179-4515-9874-d24560f82987"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onshowphoneTap",
                "implHandler": [
                    "//change the phone label\r",
                    "//showphone\r",
                    "var BusinessStore = Ext.getStore('BusinessStore');\r",
                    "var BusinessRecord = BusinessStore.getAt(0);\r",
                    "button.setText(BusinessRecord.get('business_phone'));\r",
                    "\r",
                    "\r",
                    "//use the gegenral API to update the counter\r",
                    "var GeneralActionStore = Ext.getStore('GeneralActionStore');\r",
                    "var url = 'http://'+localStorage.serverpath+'/Server-side/BusinessesGeneralAPI.php';\r",
                    "var proxy= GeneralActionStore.getProxy();\r",
                    "proxy.setUrl(url);\r",
                    "proxy.setExtraParam('BusinessID', BusinessRecord.get('business_id') );\r",
                    "proxy.setExtraParam('MethodName', 'BusinessPhoneClickCount' );\r",
                    "GeneralActionStore.load({callback: function(records, operation, success) {\r",
                    "    //console.log('callback onhomepagebtnTap');\r",
                    "    console.log('BusinessPhoneClickCount done');\r",
                    "\r",
                    "    var ResultRecord = GeneralActionStore.getAt(0);\r",
                    "    var Result = ResultRecord.get('result');\r",
                    "    console.log('Result:'+Result);\r",
                    "}\r",
                    "});"
                ],
                "name": "tap",
                "designer|targetType": "Ext.Button",
                "designer|controlQuery": "showphone"
            },
            "designerId": "e3fed2ca-72c1-47fe-9b1d-917ca8e98fd6"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "websiteTitle",
                "selector": "#websiteTitle",
                "xtype": "Ext.Label"
            },
            "designerId": "0bf5432b-e7c7-47d3-98f7-1340769e4eb0"
        }
    ]
}